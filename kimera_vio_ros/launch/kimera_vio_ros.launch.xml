<launch>
  <arg name="dataset_name" default="EuRoC"/>
  <arg name="parallel" default="flase" />
  <arg name="use_sim_time" default="true"/>

  <!-- If true, SparkVio will log output of all modules to the
  'log_output_path' location. -->
  <arg name="log_output" default="false"/>
  <arg name="log_output_path"
  default="$(find-pkg-share kimera_vio_ros)/output_logs/"/>


  <!-- If true, SparkVio will enable the LoopClosureDetector module. -->
  <arg name="use_lcd" default="false"/>

  <!-- Parameters -->
  <!-- each dataset has its own set of parameter files -->
  <!-- the parameters are set in param folder, ordered by the dataset's name -->
  <arg name="params_folder"
  default="$(find-pkg-share kimera_vio_ros)/param/$(var dataset_name)"/>

  <!-- Specify the absolute path to the vocabulary file. -->
  <!-- This is usually in the VIO directory (VIO/vocabulary/ORBvoc.yml). -->
  <!-- <arg name="path_to_vocab" default="$(find-pkg-share kimera_vio)/vocabulary/ORBvoc.yml"/> -->
  <arg name="path_to_vocab" default="/opt/overlay_ws/src/MIT-SPARK/Kimera-VIO/vocabulary/ORBvoc.yml"/>

  <!-- Subscribed Topics -->
  <arg name="topic.left.image"    default="/cam0/image_raw"/>
  <arg name="topic.right.image"   default="/cam1/image_raw"/>
  <arg name="topic.imu.data"      default="/imu0"/>

  <arg name="use_camera_info"     default="true"/>
  <arg name="topic.left.info"     default="/cam0/camera_info"/>
  <arg name="topic.right.info"    default="/cam1/camera_info"/>

  <!-- Frame IDs -->
  <arg name="frame_id.base_link" default="base_link"/>
  <arg name="frame_id.map"       default="map"/>
  <arg name="frame_id.world"     default="world"/>

  <!-- General parameters -->
  <arg name="verbosity"    default="0" />
  <!-- Visualize pipeline output in OpenCV. -->
  <!-- Note that this is duplicated from the flags file -->
  <arg name="visualize"    default="false" />
  <!-- <arg name="rectified"    default="true" /> -->

  <!-- Launch main node  -->
  <node name="kimera_vio_ros" pkg="kimera_vio_ros" exec="stereo_vio_node"
    output="screen" ns="kimera_vio_ros"
    args="--use_lcd=$(var use_lcd) \
        --vocabulary_path=$(var path_to_vocab) \
        --flagfile=$(var params_folder)/flags/Mesher.flags \
        --flagfile=$(var params_folder)/flags/VioBackEnd.flags \
        --flagfile=$(var params_folder)/flags/RegularVioBackEnd.flags \
        --flagfile=$(var params_folder)/flags/Visualizer3D.flags \
        --logtostderr 1 \
        --colorlogtostderr 1 \
        --log_prefix 1 \
        --v=$(var verbosity) \
        --log_output=$(var log_output) \
        --output_path=$(var log_output_path) \
        --visualize=$(var visualize)">
    <param name="params_folder"  value="$(var params_folder)"/>

    <param name="use_sim_time"      value="$(var use_sim_time)"/>
    <param name="use_lcd"           value="$(var use_lcd)"/>

    <!-- Frame IDs for Odometry -->
    <param name="frame_id">
        <param name="base_link" value="$(var frame_id.base_link)"/>
        <param name="map"       value="$(var frame_id.map)"/>
        <param name="world"     value="$(var frame_id.world)"/>
    </param>

    <!-- Subscriber topics -->
    <remap from="left/image"        to="$(var topic.left.image)"/>
    <remap from="right/image"       to="$(var topic.right.image)"/>
    <remap from="imu/data"          to="$(var topic.imu.data)"/>

    <param name="use_camera_info"   value="$(var use_camera_info)"/>
    <remap from="left/camera_info"  to="$(var topic.left.info)"/>
    <remap from="right/camera_info" to="$(var topic.right.info)"/>

    <!-- Remap publisher topics -->
    <remap from="odometry"                to="odometry"/>
    <remap from="resiliency"              to="resiliency"/>
    <remap from="imu_bias"                to="imu_bias"/>
    <remap from="optimized_trajectory"    to="optimized_trajectory"/>
    <remap from="pose_graph"              to="pose_graph"/>
    <remap from="mesh"                    to="mesh"/>
    <remap from="frontend_stats"          to="frontend_stats"/>
    <remap from="debug_mesh_img"          to="debug_mesh_img"/>
    <remap from="time_horizon_pointcloud" to="time_horizon_pointcloud"/>

    <!-- Resiliency Thresholds: TODO(Sandro) document -->
    <param name="velocity_det_threshold"  value="0.1"/>
    <param name="position_det_threshold"  value="0.3"/>
    <param name="stereo_ransac_threshold" value="20"/>
    <param name="mono_ransac_threshold"   value="30"/>

    <!-- Load calibration -->
    <!-- <rosparam command="load" file="$(var params_folder)/calibration.yaml"/> -->
  </node>

  <!-- Launch visualizer -->
  <!-- <include file="$(find pose_graph_tools)/launch/posegraph_view.launch" >
  <arg name="frame"         value="$(var world_frame_id)" />
  <arg name="graph_topic"   value="pose_graph" />
  <arg name="ns"            value="kimera_vio_ros"/>
  </include> -->

  <!-- <node pkg="demo_nodes_cpp" exec="talker"/>
  <node pkg="demo_nodes_cpp" exec="listener"/> -->

</launch>
